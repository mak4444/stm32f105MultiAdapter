# stm32f105MultiAdapter

Проверялось на Linux/64
Для независимости от платформы в для целевой компиляции использовалась виртуальная форт машина на СИ.

Контроллер stm32f105 (thumb2)
Для отладчика создается промежуточное ассемблерные представление
(файлы с суффиксом _AL) из исходнного кода на Форте (see SRC/).
Применяется инлайн подстановка с оптимизацией MetaCortex/SRC/macroopt.f 
Переменная TMM_SIZE содержит максимальный размер инлайн подстановки.
TSET-OPT - включить оптимизацию
TDIS-OPT - отключить оптимизацию
Слова для словаря прописываются в отдельном файле Wortbirne.s  

 Далее собирается с помощью arm-none-eabi-gcc.
Под Eclipse можно отлаживать. http://fpauk.narod.ru/stm32f105cbt6_debug_forth.jpg

Взаимодействие с пользователем осуществляется посредством USB (VT100).
Сначала появляется меню выбора режима работы.
Пункт "FORTH (original)" - запуск Форт системы с изначальным состоянием переменных.

Работает компиляция в ОЗУ.
Для сохранения образа ОЗУ используется команда SAVE.
Пункт меню "FORTH (rest)" при старте - запуск Форт системы с восстановлением 
образа ОЗУ.

Пункт меню "CAN" - запуск CAN адаптера (serial can).
при этом пункте указана скорость по умолчанию.

эту скорость можно изменить параметром -s в команде
sudo slcand -s2 -o -c -F  /dev/ttyACM0
коеффициент 2 соответсвует 50 kBod

Скорость по умолчанию можно поменять в Форт - режиме командой CAN! ( bod -- )
Пример установки 100 kBod :
100000  CAN! SAVE COLD 
команда SAVE запишит значение переменных во флеш.
COLD - перезапуск системы с перезаписью переменных из флеша


Пункт меню "USB-UART" - запуск USB-UART адаптера. (простой транзит)
при этом пункте указана скорость.
Скорость можно поменять в Форт - режиме коммандой UBR! ( bod -- )
Пример установки 9600 Bod :
9600 UBR! SAVE COLD 

Download: https://github.com/mak4444/stm32f105MultiAdapter

https://sites.google.com/view/industry-4-1-roboholding Индустрия 4.1 - роботовладение
